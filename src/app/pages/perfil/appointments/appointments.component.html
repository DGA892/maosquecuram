<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Meus Agendamentos - Cl√≠nica de Massoterapia</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="appointments.component.css" rel="stylesheet">
</head>

<body>

  <!-- Header -->
  <header id="header" class="header d-flex align-items-center">
    <div class="container d-flex align-items-center justify-content-between">
      <a [routerLink]="['/home']" class="logo d-flex align-items-center me-auto me-lg-0">
        <img src="assets/img/logo.png" alt="M√£os que Curam">
        <h1 class="sitename"><span>M√£os que Curam</span></h1>
      </a>
      <nav id="navbar" class="navbar">
        <ul class="d-flex list-unstyled">
          <li class="me-2">
            <a [routerLink]="['/home']" class="btn custom-btn">In√≠cio</a>
          </li>
          <li>
            <a [routerLink]="['/profile']" class="btn custom-btn">Perfil</a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main id="main">
    <section id="appointments" class="section">
      <div class="container" data-aos="fade-up">

        <div class="section-header text-center">
          <h2>Meus Agendamentos</h2>
          <p>Gerencie suas sess√µes j√° marcadas</p>
        </div>

        <!-- tabela -->
        <div class="row justify-content-center">
          <div class="col-lg-10">
            <div class="table-responsive" *ngIf="agendamentos.length > 0; else semAgendamentos">
              <table class="table table-bordered table-hover align-middle text-center">
                <thead class="table-primary">
                  <tr>
                    <th>Data</th>
                    <th>Hor√°rio</th>
                    <th>Servi√ßo</th>
                    <th>Profissional</th>
                    <th>Cliente</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let ag of agendamentos; let i = index">
                    <td>{{ ag.data | date: 'dd/MM/yyyy' }}</td>
                    <td>{{ ag.hora }}</td>
                    <td>{{ ag.servico }}</td>
                    <td>{{ ag.profissional }}</td>
                    <td>{{ ag.user }}</td>
                    <td>
                      <ng-container *ngIf="isEditable(ag); else bloqueado">
                        <button class="btn btn-warning btn-sm me-1" (click)="openEditModal(i)">
                          Remarcar
                        </button>
                        <button class="btn btn-danger btn-sm" (click)="openCancelModal(i)">
                          Cancelar
                        </button>
                      </ng-container>
                      <ng-template #bloqueado>
                        <button class="btn btn-secondary btn-sm" disabled>Indispon√≠vel</button>
                      </ng-template>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <ng-template #semAgendamentos>
              <div class="alert alert-info text-center mt-3">
                Nenhum agendamento encontrado para este usu√°rio.
              </div>
            </ng-template>
          </div>
        </div>

      </div>
    </section>
  </main>

  <!-- üü° MODAL REMARCAR -->
<div class="modal-custom" *ngIf="editModalOpen">
  <div class="modal-content">
    <span class="close" (click)="closeEditModal()">&times;</span>
    <h5>Remarcar Agendamento</h5>

    <label for="new-date">Nova Data:</label>
    <input type="date" id="new-date" class="form-control mb-2" [(ngModel)]="newDate" name="newDate" />

    <label for="new-time">Novo Hor√°rio:</label>
    <input type="time" id="new-time" class="form-control mb-3" [(ngModel)]="newTime" name="newTime" />

    <div *ngIf="modalWarning" class="text-danger mb-2">
      S√≥ √© poss√≠vel remarcar com mais de 24h de anteced√™ncia.
    </div>

    <button class="btn btn-primary w-100"
            (click)="saveChanges()"
            [disabled]="modalWarning || !newDate || !newTime">
      Salvar Altera√ß√µes
    </button>
  </div>
</div>

<!-- üî¥ MODAL CANCELAR -->
<div class="modal-custom" *ngIf="cancelModalOpen">
  <div class="modal-content">
    <span class="close" (click)="closeCancelModal()">&times;</span>
    <h5>Cancelar Agendamento</h5>
    <p>Tem certeza que deseja cancelar este agendamento?</p>
    <div class="d-flex justify-content-between">
      <button class="btn btn-danger w-45" (click)="cancelAppointment()">Sim, Cancelar</button>
      <button class="btn btn-secondary w-45" (click)="closeCancelModal()">N√£o</button>
    </div>
  </div>
</div>

  <!-- Footer -->
  <footer id="footer" class="footer mt-4">
    <div class="container">
      <div class="copyright">
        &copy; 2025 <strong><span>Cl√≠nica de Massoterapia</span></strong>. Todos os direitos reservados.
      </div>
    </div>
  </footer>

</body>

</html>
