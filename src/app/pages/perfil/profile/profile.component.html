<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Perfil do Usuário - Clínica de Massoterapia</title>

  <!-- Bootstrap & CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./profile.component.css" rel="stylesheet">

  <style>

  </style>
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center">
    <div class="container d-flex align-items-center justify-content-between">
      <a routerLink="/home" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="Mãos que Curam">
        <h1 class="sitename"><span>Mãos que Curam</span></h1>
      </a>
      <nav id="navbar" class="navbar">
        <ul class="d-flex list-unstyled">
          <li class="me-2">
            <a [routerLink]="['/home']" class="btn custom-btn">Início</a>
          </li>
          <li>
            <a [routerLink]="['/appointments']" class="btn custom-btn">Meus Agendamentos</a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main">
    <section id="profile" class="section">
      <div class="container" data-aos="fade-up">

        <div class="section-header">
          <h2>Gerenciar Perfil</h2>
          <p>Altere suas informações pessoais</p>
        </div>

        <div class="row justify-content-center">
          <div class="col-lg-8">

            <div class="profile-container" *ngIf="profileForm">

              <!-- Foto de perfil -->
              <div>
                <img [src]="usuario?.foto || 'assets/img/user-default.jpg'" alt="Foto do Usuário" class="profile-pic"
                  id="profileImage">
                <input type="file" id="uploadPhoto" accept="image/*" hidden (change)="onFileChange($event)">
                <button type="button" class="btn btn-outline-primary change-photo-btn" (click)="triggerUpload()">Alterar
                  Foto</button>
              </div>

              <!-- Formulário -->
              <div class="profile-fields">
                <form [formGroup]="profileForm" (ngSubmit)="salvarAlteracoes()">

                  <!-- Nome -->
                  <div class="form-group mt-3 d-flex align-items-center">
                    <div style="flex:1">
                      <label for="nome">Nome</label>
                      <input type="text" formControlName="nome" class="form-control" id="nome"
                        [readonly]="!profileForm.get('nome')?.enabled">
                    </div>
                    <button type="button" class="btn btn-secondary btn-edit"
                      (click)="toggleEdit('nome')">Editar</button>
                  </div>

                  <!-- Email -->
                  <div class="form-group mt-3 d-flex align-items-center">
                    <div style="flex:1">
                      <label for="email">E-mail</label>
                      <input type="email" formControlName="email" class="form-control" id="email"
                        [readonly]="!profileForm.get('email')?.enabled">
                    </div>
                    <button type="button" class="btn btn-secondary btn-edit"
                      (click)="toggleEdit('email')">Editar</button>
                  </div>

                  <!-- Senha -->
                  <div class="form-group mt-3 d-flex align-items-center">
                    <div style="flex:1">
                      <label>Senha</label>
                      <button type="button" class="btn btn-outline-primary w-100" (click)="alterarSenha()">
                        Alterar Senha
                      </button>
                    </div>
                  </div>

                  <!-- Telefone -->
                  <div class="form-group mt-3 d-flex align-items-center">
                    <div style="flex:1">
                      <label for="numtel">Número de telefone</label>
                      <input type="tel" formControlName="numtel" class="form-control" id="numtel"
                        [readonly]="!profileForm.get('numtel')?.enabled">
                    </div>
                    <button type="button" class="btn btn-secondary btn-edit"
                      (click)="toggleEdit('numtel')">Editar</button>
                  </div>


                  <!-- Data de nascimento -->
                  <div class="form-group mt-3 d-flex align-items-center">
                    <div style="flex:1">
                      <label for="dataNascimento">Data de Nascimento</label>
                      <input type="text" formControlName="dataNascimento" class="form-control" id="dataNascimento"
                        placeholder="dd/MM/yyyy" [readonly]="!profileForm.get('dataNascimento')?.enabled"
                        (input)="formatarDataNascimento($event)">
                    </div>
                    <button type="button" class="btn btn-secondary btn-edit"
                      (click)="toggleEdit('dataNascimento')">Editar</button>
                  </div>



                  <!-- Botão Salvar -->
                  <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary" [disabled]="!profileForm.valid">Salvar
                      Alterações</button>
                  </div>

                  <!-- Mensagens -->
                  <div *ngIf="successMessage" class="alert alert-success mt-3">{{ successMessage }}</div>
                  <div *ngIf="errorMessage" class="alert alert-danger mt-3">{{ errorMessage }}</div>

                </form>
              </div>
            </div>

          </div>
        </div>

      </div>
    </section>
  </main>

  <footer id="footer" class="footer">
    <div class="container">
      <div class="copyright">
        &copy; 2025 <strong><span>Clínica de Massoterapia</span></strong>. Todos os direitos reservados.
      </div>
    </div>
  </footer>


  <!-- Scripts -->
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
    // Função para habilitar edição do campo
    function enableField(fieldId) {
      const field = document.getElementById(fieldId);
      field.removeAttribute('readonly');
      field.focus();
    }

    // Submissão do formulário
    const profileForm = document.getElementById('profileForm');
    profileForm.addEventListener('submit', function (e) {
      e.preventDefault();
      const nome = document.getElementById('nome').value;
      const email = document.getElementById('email').value;
      const senha = document.getElementById('senha').value;
      const telefone = document.getElementById('telefone').value;
      alert(`Perfil atualizado!\n\nNome: ${nome}\nEmail: ${email}\nTelefone: ${telefone}`);
    });

    // Alterar foto de perfil
    const uploadPhoto = document.getElementById('uploadPhoto');
    const profileImage = document.getElementById('profileImage');

    uploadPhoto.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          profileImage.src = e.target.result;
        }
        reader.readAsDataURL(file);
      }
    });
  </script>
</body>

</html>